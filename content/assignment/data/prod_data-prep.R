# Cargar paquetes a utilizar
pacman::p_load(dplyr)


## ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#Base de datos COVID 19 al 25 de abril de 2020

covid <- read.csv("/cloud/project/2020-05-29-CasosConfirmados.csv")

#Base de datos CASEN 2017
load("/cloud/project/casen2017_sub.RData"); casen17 <- BCASEN1;remove(BCASEN1)

## ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
names(covid)

## ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
names(casen17)

## ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
casen17$v27a[casen17$v27a==99] <-NA 
casen17$v27a[casen17$v27a==0]  <-NA 

## ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
casen1 <- casen17 %>% select(cod_comuna=comuna,"dorm_hh"=v27a,tot_per) %>% mutate(hacinamiento=tot_per/dorm_hh)

## ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
casen2 <- casen1 %>% group_by(cod_comuna) %>% summarise(mean_hacinamiento=mean(hacinamiento,na.rm = T))

## ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
covid1 <- covid %>% select(comuna=Comuna,cod_comuna=Codigo.comuna,poblacion=Poblacion,casos_conf=Casos.Confirmados) %>% mutate(t_contagio = (casos_conf*100000)/poblacion)


## ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
dat01 <- left_join(x = covid1,y =casen2)


## ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
save(dat01, file = "CASEN-COVID19.RData")
