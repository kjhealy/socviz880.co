---
title: "Estad√≠stica Multivariada"
author: ".small[Valentina Andrade <br><br> Departamento de Sociolog√≠a - UCH / COES <br><br>]"
date: "2do Sem 2019"
output:
  xaringan::moon_reader:
    includes:
      after_body: "../insert-logo.html"     
    css: ["../custom_2020.css","https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css"] # "../ninjutsu.css", paraflipbook
    lib_dir: libs
    nature:
      ratio: '16:9'
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      beforeInit: "../macros.js"
    seal: false # esto omite title slide autom√°tica
---
class: front

```{r eval=FALSE, include=FALSE}
# Correr esto para que funcione el infinite moonreader, el root folder debe ser static para si dirigir solo "bajndo" en directorios hacia el bib y otros

xaringan::inf_mr('/static/docpres/02_bases/2mlmbases.Rmd')

```

```{r setup, include=FALSE, cache = FALSE}
require("knitr")
options(htmltools.dir.version = FALSE)
opts_chunk$set(warning=FALSE,
             message=FALSE,
             echo=T,
             cache = TRUE, fig.width=7, fig.height=5.2)
```
```{r, warning= FALSE, echo = F}
pacman::p_load(dplyr, #manipulacion de datos
               sjPlot, #tablas
               summarytools, #estadisticos descriptivos
               sjlabelled,
               flipbookr, sjmisc)
```

```{r, echo = FALSE}
load(url("https://multivariada.netlify.app/assignment/data/proc/ELSOC_ess.RData")) # Cargar base de datos

```


.pull-left[
# Estad√≠stica Multivariada
## Valentina Andrade
.small[
## Apoyo docente
## Sociolog√≠a FACSO - UChile
## 1er Sem 20201
## [multivariada.netlify.com](https://multivariada.netlify.com)
]]


.pull-right[
.right[
![:scale 70%](https://multivariada.netlify.com/img/hex_multiva.png)
<br>
<br>
## Pr√°ctica 6.2: Predictores categ√≥ricos

üìå[URL a pr√°ctica](https://multivariada.netlify.app/assignment/06.2-code/) 
]

]
---

layout: true
class: animated, fadeIn

---
class: inverse, bottom, right, animated, slideInRight

# Objetivo de la pr√°ctica

Interpretar  **predictores categ√≥ricos** en la regresi√≥n lineal.


---
class: inverse, bottom, right, animated, slideInRight

# Contenidos

### 1. Regresi√≥n con variable independiente categ√≥rica


### 2. Predictores dicot√≥micos


### 3. Predictores polit√≥micos

---

class: roja, bottom, right, slideInRight

# 1. Regresi√≥n con variable independiente categ√≥rica


---

## Variables categ√≥ricas
- Hasta el momento s√≥lo hemos considerado variables como **continuas/intervalares**.

- A menudo, las variables explicativas son de naturaleza **cualitativa o categ√≥rica**.

---
### Variables binarias / dicot√≥micas üî¥ üîµ
- Hombre, Mujer
- Vivo, Muerto
- Vot√≥, No Vot√≥.


### Variables polit√≥micas üî¥ üîµ üü£ üü¢
- B√°sica, Med√≠a, T√©cnica, Universitaria
- Frente Amplio, Nueva Mayor√≠a, Chile Vamos, No interesado.

---

### Un error muy com√∫n ‚ùå
.pull-left[
```{r,message=FALSE, warning=FALSE, echo = F}
plot_scatter(data = elsoc_18,x = sexo,y = ess,fit.grps = "lm")
```
]
.pull-right[
El scatterplot **no es muy informativo** debido a que nuestra variable independiente solamente posee dos niveles, de modo tal que la distribuci√≥n de Estatus Social Subjetivo se separa en dos grandes grupos.
]
---

### Relacionar correctamente predictores categ√≥ricos ‚úî
.pull-left[
```{r,message=FALSE, warning=FALSE, echo = F}
plot_grpfrq(var.cnt = elsoc_18$ess,var.grp = elsoc_18$sexo,type = "box")
```
]
.pull-right[
Esto significa que tendremos dos niveles en los valores de la variable X: 0 (Hombre) y 1 (Mujer). Como mostraremos la regresi√≥n con predictores categ√≥ricos significar√° **contrastar medias** entre los niveles.
]
---
.pull-left[
## Predictores categ√≥ricos


- Ej, Y=Estatus social subjetivo, X= sexo



$$X=1(Mujer)$$
$$X=0(Hombre)$$

- Las variables 1/0 usualmente son llamadas variables **dummy**
]


--
<br>
<br>

.pull-right[

Para las mujeres: $Y=\alpha +\beta X= \alpha+\beta$

Para los hombres: $Y=\alpha +\beta X= \alpha$

### El coeficiente $\beta$ es la **diferencia** esperada de $Y$ (ingreso) entre hombres y mujeres.


]

---

class: roja, bottom, right, slideInRight

# 2. Predictor dicot√≥mico

---

## Variables

* [`ess`]: "Estatus Social Subjetivo: Donde se ubicaria ud. en la sociedad chilena" (0 = el nivel mas bajo; 10 = el nivel mas alto)

* [`edcine`]: ¬øCu√°l es su nivel educacional? Indique el tipo de estudio actual (si estudia actualmente) o el √∫ltimo tipo aprobado (si no estudia actualmente) -  **CINE 2011 (UNESCO)**.

* [`sexo`]: Sexo entrevistado.

* [`edad`]: ¬øCu√°les su edad? (a√±os cumplidos).

---
## Ejemplo estimaci√≥n
<br>
.small[
.pull-left[

```{r, include = T}
reg1<- lm(ess ~ sexo, data=elsoc_18)
```
```{r, eval = F}
sjPlot::tab_model(list(reg1),
                  show.ci=FALSE,
                  p.style = "stars",
                  string.pred = "Predictores",
                  string.est = "Œ≤",
                  digits = 3,
                  dv.labels = c("Modelo 1"))
```

]

--

.pull-right[
```{r, echo = F}
sjPlot::tab_model(list(reg1), show.ci=FALSE, p.style = "stars",string.pred = "Predictores", string.est = "Œ≤",digits = 3,
                  dv.labels = c("Modelo 1"))
```
]
]

---
## Ejemplo estimaci√≥n
<br>
.small[
.pull-left[
```{r, echo = F, include = T}
sjPlot::tab_model(list(reg1), show.ci=FALSE, p.style = "stars",string.pred = "Predictores", string.est = "Œ≤",digits = 3,
                  dv.labels = c("Modelo 1"))
```
]
]

--

.pull-right[
Las mujeres (sexo=1) obtienen 0.13 puntos promedio menos **en relaci√≥n** a los hombres (sexo=0) en la variable de estatus social subjetivo, manteniendo las otras variables constantes.
]


---

Para el caso de los **hombres** tenemos:

$$\widehat{Y}_\text{estatus} = 4.339 + 0.133 \times 0 = 4.339$$
<br>
En cambio, para las **mujeres** tenemos:

$$\widehat{Y}_\text{estatus} = 4.339 + 0.133 \times 1 = 4.472$$

---

## ¬øQu√© pasa si tenemos m√°s predictores?
.small[
.pull-left[
```{r, echo = F}
reg2<-lm(ess ~ sexo+edad, data=elsoc_18)

sjPlot::tab_model(list(reg1,reg2), show.ci=FALSE, p.style = "stars",string.pred = "Predictores", string.est = "Œ≤",digits = 3,
                  dv.labels = c("Modelo 1", "Modelo 2"))
```
]
.pull-right[
Al controlar por la **edad** de las personas, **las mujeres tienen un promedio 0.126 m√°s alto que el de los hombres** en la escala de Estatus Social Subjetivo. Vemos que, en comparaci√≥n con el Modelo 1, la diferencia en el promedio de estatus subjetivo de mujeres respecto de hombres se ajusta al incorporar la *edad*.
]
<br>
$$\widehat{Y}_\text{estatus} = 4.602 + 0.126 \times \text{Sexo} + -0.006 \times \text{Edad} + \epsilon $$]

---

class: roja, bottom, right, slideInRight

# 3. Predictor polit√≥mico

---

## 3. Predictor polit√≥mico

- ¬øQu√© sucede cuando quiero predecir el estatus social subjetivo en base una variable cat√©gorica con **m√°s de dos valores**?
  - Ej. Niveles educacionales, clase social, posici√≥n pol√≠tica.

- Para poder trabajar correctamente los predictores categ√≥ricos en la regresi√≥n, en R la manera m√°s simple es definirlos como un **factor**.

---

## Paso 1: ¬øCu√°l es la clase de mi variable?
.small[
```{r}
elsoc_18$ed_cine <- as.numeric(elsoc_18$edcine)
```

```{r}
str(elsoc_18$ed_cine)
```
]

---

### Si corremos la regresi√≥n tal como est√°

.small[
.pull-left[
```{r}
reg3<- lm(ess~ed_cine,data = elsoc_18)
```
```{r, echo = F }
sjPlot::tab_model(list(reg3), show.ci=FALSE, p.style = "stars",string.pred = "Predictores", string.est = "Œ≤",digits = 3,
                  dv.labels = c("Modelo 3"))
```
]]

.pull-right[
- El coeficiente de regresi√≥n nos indica que por cada nivel adicional de educaci√≥n, hay un aumento de **0.331 puntos** en la escala de estatus social subjetivo.
- Decir "por cada nivel educacional" es poco informativo
]

---

## Paso 2: Transformar variable con `as_factor()`

- `as_factor()` de la librer√≠a `sjlabelled`
- ‚ö† no es lo mismo `as_factor()` que `as.factor()`


```{r}
elsoc_18$edcine<- as_factor(elsoc_18$edcine)
```

---

## Paso 3: Estimar el modelo

```{r}
reg4 <- lm(ess~edcine,data = elsoc_18)
```

```{r, eval = F}
reg4 <- lm(ess~as_factor(edcine),data = elsoc_18)
```

---

.small[
```{r, echo = F }
sjPlot::tab_model(list(reg3,reg4), show.ci=FALSE, p.style = "stars",string.pred = "Predictores", string.est = "Œ≤",digits = 3,
                  dv.labels = c("Modelo 3","Modelo 4"))
```
]
---

## Interpretaci√≥n üìù

- La categor√≠a ausente en el modelo es la **categor√≠a de referencia** para la intepretaci√≥n

--

- El *coeficiente* de la variable dummy corresponde a su **diferencia** respecto de la categor√≠a de referencia (en relaci√≥n a la variable dependiente $Y$) 

--

- La decisi√≥n de qu√© categor√≠a es la referencia obedece a la mejor **interpretaci√≥n**

---

## üéÅ Bonus: Redefinir la categor√≠a de referencia `relevel`

- Alternativamente es posible cambiar la categor√≠a de referencia. Por ejemplo, si quisieramos que la referencia fuera el nivel educativo m√°s alto "Terciaria y Postgrado" (5) debemos usar `ref_lvl(edcine, ref =5)`:


```{r}
reg4.1 <- lm(ess~ref_lvl(edcine,lvl=5),data = elsoc_18)
```
---
.small[
```{r, echo = F }
sjPlot::tab_model(list(reg4,reg4.1), show.ci=FALSE, p.style = "stars",string.pred = "Predictores", string.est = "Œ≤",digits = 3,
                  dv.labels = c("Modelo 4","Modelo 4.1"))
```
]


---
class: inverse

## Resumen predictores categ√≥ricos

- Predictores categ√≥ricos se especifican como **variables dicot√≥micas** (valores 1/0, presencia/ausencia del atributo) o **polit√≥micas** (varios niveles)

--

- La variable que no ingresa al modelo es la **categor√≠a de referencia**. Tambi√©n se puede pre-definir la categor√≠a de referencia

--

- El *coeficiente* de la variable dummy corresponde a su **diferencia** respecto de la categor√≠a de referencia (en relaci√≥n a la variable dependiente $Y$) 


---
class: front

.pull-left[
# Estad√≠stica Multivariada
## Valentina Andrade
.small[
## Apoyo docente
## Sociolog√≠a FACSO - UChile
## 1er Sem 20201
## [multivariada.netlify.com](https://multivariada.netlify.com)
]]


.pull-right[
.right[
![:scale 70%](https://multivariada.netlify.com/img/hex_multiva.png)
<br>
<br>
## Pr√°ctica 6.2: Predictores categ√≥ricos

üìå[URL a pr√°ctica](https://multivariada.netlify.app/assignment/06.2-code/) 
]

]
