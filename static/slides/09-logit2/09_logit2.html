<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Estadística Multivariada</title>
    <meta charset="utf-8" />
    <meta name="author" content=".small[Juan Carlos Castillo    Departamento de Sociología - UCH / COES   ]" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/tile-view/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view/tile-view.js"></script>
    <link href="libs/animate.css/animate.xaringan.css" rel="stylesheet" />
    <script src="libs/clipboard/clipboard.min.js"></script>
    <link href="libs/shareon/shareon.min.css" rel="stylesheet" />
    <script src="libs/shareon/shareon.min.js"></script>
    <link href="libs/xaringanExtra-shareagain/shareagain.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-shareagain/shareagain.js"></script>
    <script src="libs/fabric/fabric.min.js"></script>
    <link href="libs/xaringanExtra-scribble/scribble.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-scribble/scribble.js"></script>
    <script>document.addEventListener('DOMContentLoaded', function() { window.xeScribble = new Scribble({"pen_color":["#FF0000"],"pen_size":3,"eraser_size":30,"palette":[]}) })</script>
    <link rel="stylesheet" href="custom_2020.css" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">

class: front










<style>.shareagain-bar {
--shareagain-foreground: rgb(255, 255, 255);
--shareagain-background: rgba(0, 0, 0, 0.5);
--shareagain-twitter: none;
--shareagain-facebook: none;
--shareagain-linkedin: none;
--shareagain-pinterest: none;
--shareagain-pocket: none;
--shareagain-reddit: none;
}</style>



&lt;!---
Para correr en ATOM
- open terminal, abrir R (simplemente, R y enter)
- rmarkdown::render('static/docpres/07_interacciones/7interacciones.Rmd', 'xaringan::moon_reader')

About macros.js: permite escalar las imágenes como [scale 50%](path to image), hay si que grabar ese archivo js en el directorio.
---&gt;


.pull-left[
# Estadística Multivariada
## Juan Carlos Castillo
## Sociología FACSO - UChile
## 1er Sem 2021
## [.purple[multivariada.netlify.com]](https://multivariada.netlify.com)
]


.pull-right[
.right[
&lt;br&gt;
## .purple[Sesión 9: Regresión Logística (2)]
![:scale 70%](https://multivariada.netlify.com/img/hex_multiva.png)



]

]
---

layout: true
class: animated, fadeIn


---
class: inverse, bottom, right, animated, slideInRight


# .red[Contenidos]

## 1. Repaso de sesión anterior 

## 2. Estimación regresión logística

## 3. Ajuste regresión logística


---
class: roja bottom right slideInRight

# 1. Repaso sesión anterior

---
## Variables

- discretas (Rango finito de valores):

      - Dicotómicas
      - Politómicas

- continuas:

      - Rango (teóricamente) infinito de valores.

---
## Tipos de análisis estadístico bivariado

- Variable dependiente (y) : lo que quiero explicar

- Variable independiente (x): lo que me permite explicar la dependiente

.small[
| Variable independiente x 	| Variable dependiente Categórica   	| Variable dependiente Continua        	|
|--------------------------	|-----------------------------------	|--------------------------------------	|
| Categórica               	| Análisis de tabla de Contigencia, Chi2	| Análisis de Varianza ANOVA, Prueba T 	|
| Continua                 	| Regresión Logística 	| Correlación / Regresión Lineal                     	|
]
???


---
class: inverse, center, middle

.pull-left[
![:scale 80%](../images/postertitanic.jpg)
]

## ¿Se puede anticipar el final?

???

Si vas al cine a ver esta película, y si antes conoces los datos sobre el Titanic, puedes anticipar el final?

---
# Titanic data




.small[

<div class="container st-container">
<table class="table table-striped table-bordered st-table st-table-striped st-table-bordered st-multiline ">
  <thead>
    <tr>
      <th align="center" class="st-protect-top-border"><strong>No</strong></th>
      <th align="center" class="st-protect-top-border"><strong>Variable</strong></th>
      <th align="center" class="st-protect-top-border"><strong>Stats / Values</strong></th>
      <th align="center" class="st-protect-top-border"><strong>Freqs (% of Valid)</strong></th>
      <th align="center" class="st-protect-top-border"><strong>Graph</strong></th>
      <th align="center" class="st-protect-top-border"><strong>Valid</strong></th>
      <th align="center" class="st-protect-top-border"><strong>Missing</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td align="center">1</td>
      <td align="left">survived
[factor]</td>
      <td align="left">1. No sobrevive
2. Sobrevive</td>
      <td align="left" style="padding:0;vertical-align:middle"><table style="border-collapse:collapse;border:none;margin:0"><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">619</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">59.2%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">427</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">40.8%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr></table></td>
      <td align="left" style="vertical-align:middle;padding:0;background-color:transparent"><img style="border:none;background-color:transparent;padding:0" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAGUAAAA3CAQAAAC/M0y4AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAHdElNRQflBhQCKh87gQBKAAAAoElEQVRo3u3YywmAMBAA0USszgq0Qq0g7ek1Ch78QCbLzM1L8MFGcPOeojS0fgEpsSlj/bB2d3GWfENJaWr9bo8qp6dAAyaFmBRiUohJISaFmBRiUohJISaF2OXfvrw7BVGulyzdLVxStXCJNGCBKKe7sjWcsDl/PQGy0vvjcxNowKQQk0JMCjEpxKQQk0JMCjEpxKQQi7rS67tAAyaF2AHJKAvhi6O4OQAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyMS0wNi0yMFQwMjo0MjozMSswMDowMK7cg0UAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjEtMDYtMjBUMDI6NDI6MzErMDA6MDDfgTv5AAAAAElFTkSuQmCC"></td>
      <td align="center">1046
(100.0%)</td>
      <td align="center">0
(0.0%)</td>
    </tr>
    <tr>
      <td align="center">2</td>
      <td align="left">sex
[factor]</td>
      <td align="left">1. Hombre
2. Mujer</td>
      <td align="left" style="padding:0;vertical-align:middle"><table style="border-collapse:collapse;border:none;margin:0"><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">658</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">62.9%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">388</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">37.1%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr></table></td>
      <td align="left" style="vertical-align:middle;padding:0;background-color:transparent"><img style="border:none;background-color:transparent;padding:0" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAGsAAAA3CAQAAACh+nwLAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAHdElNRQflBhQCKh87gQBKAAAAoUlEQVRo3u3YywmAMBAA0USszgq0Qq3A9vQaBUEifmadueUiebDxsHlJEWvevoAsWW15GNEPbcgHrJS6t+9W3bw5BR1CWaRkkZJFShYpWaRkkZJFShYpWaR2u4y57iufK5fLJvTiKRWLp6hDGJS1eVvTw1PY5+vfOMF6dv155+8p6BDKIiWLlCxSskjJIiWLlCxSskjJIvWH9Wecgg6hLFIryPIL4dIA3o8AAAAldEVYdGRhdGU6Y3JlYXRlADIwMjEtMDYtMjBUMDI6NDI6MzErMDA6MDCu3INFAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIxLTA2LTIwVDAyOjQyOjMxKzAwOjAw34E7+QAAAABJRU5ErkJggg=="></td>
      <td align="center">1046
(100.0%)</td>
      <td align="center">0
(0.0%)</td>
    </tr>
    <tr>
      <td align="center">3</td>
      <td align="left">age
[numeric]</td>
      <td align="left">Mean (sd) : 29.9 (14.4)
min < med < max:
0.2 < 28 < 80
IQR (CV) : 18 (0.5)</td>
      <td align="left" style="vertical-align:middle">98 distinct values</td>
      <td align="left" style="vertical-align:middle;padding:0;background-color:transparent"><img style="border:none;background-color:transparent;padding:0" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAJgAAABuCAQAAABxABKuAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAHdElNRQflBhQCKh87gQBKAAABxElEQVR42u3cQW7CMBQAUYI4XU8AJywn6PXabWIXwhAT/+/M26FKCKbYOI7F9HsSce79ArIxGGQw6DJ/0GY+u//zNNep9xvdYv7iL28/yxNfxeOf3u+4IYckZDDIYJDBIINBBoMMBhkMMhhkMMhgkMEgg0Ef2a2olVs+ebd7dgq23PDJvN3jkIQMBhkMMhhkMMhgkMEgg0EGgwwGGQwyGGQwyGCQwaDN+2H3gx2SbbCBOPJpsJpDEjIYZDDIYJDBIINBBoN2upFbqpe7We6FdwqWd7HrkIQMBhkMMhhkMMhgkMEgg0EGgzqt9GtZjg2HCZbl2LBDEjIYZDDIYJDBIINBBoMMBhkMMhgU5tKoFPVGXNhgUW/EOSQhg0EGgwwGhZ30azG+NxMFi/G9uQg23i+wtld8wmL8FyNz0ocMBhkMMhhkMMhgkMEgg0GJLo1qPU78pA7W48SPQxJa/YTF2FSJYzVYfTl+tN8RWHpjDstyVvAzUk/6pT2mj6GCvTJ9bE04VLBa+w1RlxWQwSCDQQaDDAYZDDIYZDBo8IVrbX3r4Pm1wOGClVsHr1xO3WYJp/lfvw+9cfPYw2Ba56QPGQwyGPQHpngzWp7/U8kAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjEtMDYtMjBUMDI6NDI6MzErMDA6MDCu3INFAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIxLTA2LTIwVDAyOjQyOjMxKzAwOjAw34E7+QAAAABJRU5ErkJggg=="></td>
      <td align="center">1046
(100.0%)</td>
      <td align="center">0
(0.0%)</td>
    </tr>
  </tbody>
</table>
<p>Generated by <a href='https://github.com/dcomtois/summarytools'>summarytools</a> 0.9.9 (<a href='https://www.r-project.org/'>R</a> version 4.0.3)<br/>2021-06-19</p>
</div>
]

---
# Sobrevivientes &amp; Sexo




.pull-left[
.small[
![](09_logit2_files/figure-html/unnamed-chunk-5-1.png)&lt;!-- --&gt;
]

]
.pull-right[
![](09_logit2_files/figure-html/unnamed-chunk-6-1.png)&lt;!-- --&gt;
]

---
## Sobrevivencia / sexo

.center[
![:scale 55%](mosaic.png)
]

---
## Limitaciones modelo de regresión lineal para dependientes dicotómicas (= modelo de probabilidad lineal) 

.pull-left[




![](09_logit2_files/figure-html/unnamed-chunk-8-1.png)&lt;!-- --&gt;
]

.pull-right[




![](09_logit2_files/figure-html/unnamed-chunk-10-1.png)&lt;!-- --&gt;
]


---
class: roja, right

## La .yellow[regresión logística] ofrece una solución a los problemas del .white[rango] de predicciones y de .orange[ajuste] a los datos del modelo de probabilidad lineal

--

## Se logra mediante:
### (a) expresión de coeficientes como odds-ratio
### (b) _transformación_ de lo(s) coeficientes a *LOGIT*

---
## Curvando la recta ...

.pull-left[
![](09_logit2_files/figure-html/unnamed-chunk-11-1.png)&lt;!-- --&gt;
]

.pull-right[



![](09_logit2_files/figure-html/unnamed-chunk-13-1.png)&lt;!-- --&gt;
]


---
# Odds 

- **odds** (chances): probabilidad de que algo ocurra dividido por la probabilidad de que no ocurra

`$$Odds=\frac{p}{1-p}$$`

--

.medium[
Ej. Titanic:
  - 427 sobrevivientes (41%), 619 muertos (59%)
`$$Odds_{sobrevivir}=427/619=0.41/0.59=0.69$$`

**Es decir, las chances de sobrevivir son de 0.69**]

---
## Odds ratio (OR)

.pull-left[
- los odds-ratio (o razón de chances) permiten reflejar la asociación entre las chances de dos variables dicotómicas


**¿Tienen las mujeres más chances de sobrevivir que los hombres?**
]

--
.pull-right[
.medium[
&lt;table style="border-collapse:collapse; border:none;"&gt;
 &lt;tr&gt;
 &lt;th style="border-top:double; text-align:center; font-style:italic; font-weight:normal; border-bottom:1px solid;" rowspan="2"&gt;survived&lt;/th&gt;
 &lt;th style="border-top:double; text-align:center; font-style:italic; font-weight:normal;" colspan="2"&gt;sex&lt;/th&gt;
 &lt;th style="border-top:double; text-align:center; font-style:italic; font-weight:normal; font-weight:bolder; font-style:italic; border-bottom:1px solid; " rowspan="2"&gt;Total&lt;/th&gt;
 &lt;/tr&gt;
 
&lt;tr&gt;
 &lt;td style="border-bottom:1px solid; text-align:center; padding:0.2cm;"&gt;Hombre&lt;/td&gt;
 &lt;td style="border-bottom:1px solid; text-align:center; padding:0.2cm;"&gt;Mujer&lt;/td&gt;
 &lt;/tr&gt;
 
&lt;tr&gt; 
&lt;td style="padding:0.2cm;  text-align:left; vertical-align:middle;"&gt;No sobrevive&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:center; "&gt;&lt;span style="color:black;"&gt;523&lt;/span&gt;&lt;br&gt;&lt;span style="color:#339933;"&gt;79.5&amp;nbsp;&amp;#37;&lt;/span&gt;&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:center; "&gt;&lt;span style="color:black;"&gt;96&lt;/span&gt;&lt;br&gt;&lt;span style="color:#339933;"&gt;24.7&amp;nbsp;&amp;#37;&lt;/span&gt;&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:center;  "&gt;&lt;span style="color:black;"&gt;619&lt;/span&gt;&lt;br&gt;&lt;span style="color:#339933;"&gt;59.2&amp;nbsp;&amp;#37;&lt;/span&gt;&lt;/td&gt; 
&lt;/tr&gt;
 
&lt;tr&gt; 
&lt;td style="padding:0.2cm;  text-align:left; vertical-align:middle;"&gt;Sobrevive&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:center; "&gt;&lt;span style="color:black;"&gt;135&lt;/span&gt;&lt;br&gt;&lt;span style="color:#339933;"&gt;20.5&amp;nbsp;&amp;#37;&lt;/span&gt;&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:center; "&gt;&lt;span style="color:black;"&gt;292&lt;/span&gt;&lt;br&gt;&lt;span style="color:#339933;"&gt;75.3&amp;nbsp;&amp;#37;&lt;/span&gt;&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:center;  "&gt;&lt;span style="color:black;"&gt;427&lt;/span&gt;&lt;br&gt;&lt;span style="color:#339933;"&gt;40.8&amp;nbsp;&amp;#37;&lt;/span&gt;&lt;/td&gt; 
&lt;/tr&gt;
 
&lt;tr&gt; 
&lt;td style="padding:0.2cm;  border-bottom:double; font-weight:bolder; font-style:italic; text-align:left; vertical-align:middle;"&gt;Total&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:center;   border-bottom:double;"&gt;&lt;span style="color:black;"&gt;658&lt;/span&gt;&lt;br&gt;&lt;span style="color:#339933;"&gt;100&amp;nbsp;&amp;#37;&lt;/span&gt;&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:center;   border-bottom:double;"&gt;&lt;span style="color:black;"&gt;388&lt;/span&gt;&lt;br&gt;&lt;span style="color:#339933;"&gt;100&amp;nbsp;&amp;#37;&lt;/span&gt;&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:center;   border-bottom:double;"&gt;&lt;span style="color:black;"&gt;1046&lt;/span&gt;&lt;br&gt;&lt;span style="color:#339933;"&gt;100&amp;nbsp;&amp;#37;&lt;/span&gt;&lt;/td&gt; 
&lt;/tr&gt;
 
&lt;/table&gt;
]
]

---
# Odds Ratio
 
**¿Cuantas más chances de sobrevivir tienen las mujeres respecto de los hombres?**

- OR supervivencia mujeres / OR supervivencia hombres

.medium[
`$$OR=\frac{p_{m}/(1-p_{m})}{p_{h}/(1-p_{h})}=\frac{0.753/(1-0.753)}{0.205/(1-0.205)}=\frac{3.032}{0.257}=11.78$$`
]

--

### Las chances de sobrevivir de las mujeres son **11.78** veces más que las de los hombres.


---
class: roja bottom right

# 2. Regresión logística: Estimación 

---
# Regresión logística y odds


.pull-left[
![](09_logit2_files/figure-html/unnamed-chunk-15-1.png)&lt;!-- --&gt;
]


.pull-right[
Una de las transformaciones que permite realizar una estimación de regresión con variables dependientes dicotómicas es el **logit**, que es logaritmo de los odds.
]

---
# Logit

`$$Logit=ln(Odd)=ln(\frac{p}{1-p})$$`
---
.small[

.pull-left[
## Probabilidades, odds y logit

]

.pull-right[



```
##    prob odds logit
##  0.0010           
##  0.0564           
##  0.1119           
##  0.1673           
##  0.2228           
##  0.2782           
##  0.3337           
##  0.3891           
##  0.4446           
##  0.5000           
##  0.5554           
##  0.6109           
##  0.6663           
##  0.7218           
##  0.7772           
##  0.8327           
##  0.8881           
##  0.9436           
##  0.9990
```


]
]

---
.small[

.pull-left[
## Probabilidades, odds y logit


```r
df$odds &lt;- df$prob/(1-df$prob)

df$logit &lt;- log(df$odds)
```


]

.pull-right[



```
##    prob     odds  logit
##  0.0010   0.0010 -6.907
##  0.0564   0.0598 -2.816
##  0.1119   0.1260 -2.072
##  0.1673   0.2010 -1.605
##  0.2228   0.2866 -1.250
##  0.2782   0.3855 -0.953
##  0.3337   0.5008 -0.692
##  0.3891   0.6370 -0.451
##  0.4446   0.8004 -0.223
##  0.5000   1.0000  0.000
##  0.5554   1.2494  0.223
##  0.6109   1.5700  0.451
##  0.6663   1.9970  0.692
##  0.7218   2.5942  0.953
##  0.7772   3.4888  1.250
##  0.8327   4.9761  1.605
##  0.8881   7.9374  2.072
##  0.9436  16.7165  2.816
##  0.9990 999.0000  6.907
```


]
]

---
.small[

.pull-left[
## Probabilidades, odds y logit


```r
df$odds &lt;- df$prob/(1-df$prob)

df$logit &lt;- log(df$odds)
```


]

.pull-right[



```r
##    prob     odds  logit
##  0.0010   0.0010 -6.907
##  0.0564   0.0598 -2.816
##  0.1119   0.1260 -2.072
##  0.1673   0.2010 -1.605
##  0.2228   0.2866 -1.250
##  0.2782   0.3855 -0.953
##  0.3337   0.5008 -0.692
##  0.3891   0.6370 -0.451
##  0.4446   0.8004 -0.223
*##  0.5000   1.0000  0.000
##  0.5554   1.2494  0.223
##  0.6109   1.5700  0.451
##  0.6663   1.9970  0.692
##  0.7218   2.5942  0.953
##  0.7772   3.4888  1.250
##  0.8327   4.9761  1.605
##  0.8881   7.9374  2.072
##  0.9436  16.7165  2.816
##  0.9990 999.0000  6.907
```


]
]

---
.small[

.pull-left[
## Probabilidades, odds y logit


```r
df$odds &lt;- df$prob/(1-df$prob)

df$logit &lt;- log(df$odds)
```


]

.pull-right[



```r
##    prob     odds  logit
*##  0.0010   0.0010 -6.907
##  0.0564   0.0598 -2.816
##  0.1119   0.1260 -2.072
##  0.1673   0.2010 -1.605
##  0.2228   0.2866 -1.250
##  0.2782   0.3855 -0.953
##  0.3337   0.5008 -0.692
##  0.3891   0.6370 -0.451
##  0.4446   0.8004 -0.223
*##  0.5000   1.0000  0.000
##  0.5554   1.2494  0.223
##  0.6109   1.5700  0.451
##  0.6663   1.9970  0.692
##  0.7218   2.5942  0.953
##  0.7772   3.4888  1.250
##  0.8327   4.9761  1.605
##  0.8881   7.9374  2.072
##  0.9436  16.7165  2.816
*##  0.9990 999.0000  6.907
```


]
]



---
# Estimación en R: `glm`

```
modelo &lt;- glm(dependiente ~ indep 1 + indep2 + ...,
          data=datos,
          family="binomial")
```

- `glm` (general lineal model) es la función para variables dependientes categóricas


- `family="binomial"` indica que la dependiente es dicotómica



---
# Ejemplo Titanic

.pull-left[


```r
modelo_titanic &lt;-
glm(survived ~ sex,
data = tt,
family = "binomial")
```

]

.pull-right[.small[

&lt;table class="texreg" style="margin: 10px auto;border-collapse: collapse;border-spacing: 0px;caption-side: bottom;color: #000000;border-top: 2px solid #000000;"&gt;
&lt;caption&gt; &lt;/caption&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/th&gt;
&lt;th style="padding-left: 5px;padding-right: 5px;"&gt;Logit&lt;/th&gt;
&lt;th style="padding-left: 5px;padding-right: 5px;"&gt;OR&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr style="border-top: 1px solid #000000;"&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Intercepto&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-1.354&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;0.258&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;(0.097)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Mujer (Ref=Hombre)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;2.467&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;11.784&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;(0.152)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr style="border-top: 1px solid #000000;"&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;AIC&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1106.008&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1106.008&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;BIC&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1115.914&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1115.914&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Log Likelihood&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-551.004&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-551.004&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Deviance&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1102.008&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1102.008&lt;/td&gt;
&lt;/tr&gt;
&lt;tr style="border-bottom: 2px solid #000000;"&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Num. obs.&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1046&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1046&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;
&lt;tr&gt;
&lt;td style="font-size: 0.8em;" colspan="3"&gt;&lt;sup&gt;***&lt;/sup&gt;p &amp;lt; 0.001; &lt;sup&gt;**&lt;/sup&gt;p &amp;lt; 0.01; &lt;sup&gt;*&lt;/sup&gt;p &amp;lt; 0.05&lt;/td&gt;
&lt;/tr&gt;
&lt;/tfoot&gt;
&lt;/table&gt;

]
]


---
## Interpretación de asociaciones y contraste de hipótesis

### - Coeficiente logit asociado a sexo (mujer) = +2.467 :

  - El log-odds de sobrevivencia aumenta para las mujeres en 2.467 en comparación con los hombres. 

--

### Contraste de hipótesis

- La diferencia de las probabilidades de sobrevivir entre hombres y mujeres son estadísticamente significativas, por lo que se rechaza la hipótesis nula (de ausencia de diferencias entre hombres y mujeres) con un nivel de probabilidad `\(p&lt;0.001\)`.


---
## Interpretación de coeficientes logit


- Sustantivamente no nos dice mucho, ya que el logit es una transformación de la escala original.

- Por lo tanto, para poder interpretar el sentido del coeficiente se requiere volver a la métrica de odds mediante una transformación inversa o **exponenciación**


---
## De logits a odds 

.pull-left[
`$$logit_x=log(Odds)$$`
`$$e^{logit}=Odds_X$$`
`$$e^{2.467}=11.78$$`
]

.pull-right[

```r
exp(2.467)
```

```
## [1] 11.78703
```
### Las chances (odds) de sobrevivir siendo mujer son **11.78** veces más que las de un hombre. 
]

---
## De logits a odds

`$$Odds_X=e^{\beta_0 + \beta_jX_j}$$`
&lt;br&gt;
--
- Predicción para **mujeres**= -1.354 + (2.467 * Sexo=1) = 1.113

-  Predicción para **hombres**= -1.354 + (2.467 * Sexo=0) = -1.354

--

&lt;br&gt;

`$$Odds_{mujer}=e^{1.113}=3.032$$`
`$$Odds_{hombre}=e^{-1.354}=0.257$$`

---
## Transformación a probabilidades predichas

`$$p_{mujeres}=\frac{e^{1.113}}{1+e^{1.113}}=\frac{3.04}{4.04}=0.752$$`
`$$p_{hombres}=\frac{e^{-1.354}}{1+e^{-1.354}}=\frac{0.258}{1.258}=0.205$$`

---
## Regresión logística simple para independientes continuas

.pull-left[


```r
modelo_titanic_age &lt;-
glm(survived ~ age,
data = tt,
family = "binomial")
```

]

.pull-right[.small[

&lt;table class="texreg" style="margin: 10px auto;border-collapse: collapse;border-spacing: 0px;caption-side: bottom;color: #000000;border-top: 2px solid #000000;"&gt;
&lt;caption&gt; &lt;/caption&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/th&gt;
&lt;th style="padding-left: 5px;padding-right: 5px;"&gt;Logit&lt;/th&gt;
&lt;th style="padding-left: 5px;padding-right: 5px;"&gt;OR&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr style="border-top: 1px solid #000000;"&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Intercepto&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-0.137&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;0.872&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;(0.145)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Edad&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-0.008&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;0.992&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;(0.004)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr style="border-top: 1px solid #000000;"&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;AIC&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1415.383&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1415.383&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;BIC&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1425.288&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1425.288&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Log Likelihood&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-705.691&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-705.691&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Deviance&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1411.383&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1411.383&lt;/td&gt;
&lt;/tr&gt;
&lt;tr style="border-bottom: 2px solid #000000;"&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Num. obs.&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1046&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1046&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;
&lt;tr&gt;
&lt;td style="font-size: 0.8em;" colspan="3"&gt;&lt;sup&gt;***&lt;/sup&gt;p &amp;lt; 0.001; &lt;sup&gt;**&lt;/sup&gt;p &amp;lt; 0.01; &lt;sup&gt;*&lt;/sup&gt;p &amp;lt; 0.05&lt;/td&gt;
&lt;/tr&gt;
&lt;/tfoot&gt;
&lt;/table&gt;

]
]


---
## Plot probabilidades predichas

.center[

![](09_logit2_files/figure-html/unnamed-chunk-28-1.png)&lt;!-- --&gt;

]


---
# Regresión logística multiple

.pull-left[


```r
modelo_titanic2 &lt;-
glm(survived ~ sex + age,
data = tt,
family = "binomial")
```

]

.pull-right[.small[

&lt;table class="texreg" style="margin: 10px auto;border-collapse: collapse;border-spacing: 0px;caption-side: bottom;color: #000000;border-top: 2px solid #000000;"&gt;
&lt;caption&gt; &lt;/caption&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/th&gt;
&lt;th style="padding-left: 5px;padding-right: 5px;"&gt;Logit&lt;/th&gt;
&lt;th style="padding-left: 5px;padding-right: 5px;"&gt;OR&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr style="border-top: 1px solid #000000;"&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Intercepto&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-1.23&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;0.29&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;(0.18)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Mujer (Ref=Hombre)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;2.46&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;11.71&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;(0.15)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Edad&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-0.00&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1.00&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;(0.01)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr style="border-top: 1px solid #000000;"&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;AIC&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1107.34&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1107.34&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;BIC&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1122.20&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1122.20&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Log Likelihood&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-550.67&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-550.67&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Deviance&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1101.34&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1101.34&lt;/td&gt;
&lt;/tr&gt;
&lt;tr style="border-bottom: 2px solid #000000;"&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Num. obs.&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1046&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1046&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;
&lt;tr&gt;
&lt;td style="font-size: 0.8em;" colspan="3"&gt;&lt;sup&gt;***&lt;/sup&gt;p &amp;lt; 0.001; &lt;sup&gt;**&lt;/sup&gt;p &amp;lt; 0.01; &lt;sup&gt;*&lt;/sup&gt;p &amp;lt; 0.05&lt;/td&gt;
&lt;/tr&gt;
&lt;/tfoot&gt;
&lt;/table&gt;

]
]





---
class: roja bottom right

# 3. Regresión logística: Ajuste 


---
## Ajuste: ¿Qué tan bueno es nuestro modelo?

- **DISTINTO a regresión OLS** (no hay varianza en dependiente dicotomica)

--

- Para evaluar ajuste se utiliza la **log-verosimilitud** (log-likelihood), que se asocia a la idea de **residuos** del modelo

--

- La log verosimilitud del modelo se obtiene del proceso de estimación por .red[máxima verosimilitud] (...tema para otro curso)

---
## Ajuste: ¿Qué tan bueno es nuestro modelo?


```r
logLik(modelo_titanic) # sexo
```

```
## 'log Lik.' -551.0042 (df=2)
```

```r
logLik(modelo_titanic2) # sexo + edad
```

```
## 'log Lik.' -550.6695 (df=3)
```

La inclusión de un predictor adicional (edad) hace que cambie la log-verosimilitud del modelo

---
## Ajuste: ¿Qué tan bueno es nuestro modelo?

- No existe una **única forma** de estimar el ajuste en regresión logística

--

- El ajuste de los modelos logísticos se evalúa en general en términos **.blue[comparativos]** con otros modelos 

--

- Estas medidas de comparación se basan en distintas fórmulas que consideran la **.red[log verosimilitud (o  LL)]** y la **devianza**

---
.pull-left-narrow[## Modelo saturado, nulo y logístico
]

![:scale 65%](deviance.png)

---
## Ajuste: ¿Qué tan bueno es nuestro modelo?

- Entre las medidas/indicadores de ajuste usualmente se consideran:

  - Devianza

  - Test de razón de verosimilitud (likelihood ratio test)
  
  - R2s
  
  - Criterio de información de Akaike

---
## Devianza

- Concepto: el modelo saturado es básicamente residuos, y la devianza nos indica cuánto se han reducido los residuos a medida que se introducen parámetros al modelo. Por eso también se conoce como devianza residual.


--

- Formula: **.red[Devianza =-2*log likelihood]**


---
## Test de razón de verosimilitud (LRT) (...o de diferencia de devianzas)

.pull-left-narrow[
.medium[]
- Se comparan las devianzas de distintos modelos: si la devianza es significativamente menor, el modelo es mejor
]

.pull-right-wide[
.small[
Obtención de devianzas

```r
-2*logLik(modelo_titanic)
```

```
## 'log Lik.' 1102.008 (df=2)
```

```r
-2*logLik(modelo_titanic2)
```

```
## 'log Lik.' 1101.339 (df=3)
```
O directamente:

```r
modelo_titanic$deviance
```

```
## [1] 1102.008
```
]
]

---
.pull-left-narrow[

## Test de razón de verosimilitud 

.medium[
Comando .red[`anova`] en .red[`R`]
]
]

.pull-right-wide[
&lt;br&gt;

.small[

```r
anova(modelo_titanic, modelo_titanic2, test ="Chisq")
```

```
## Analysis of Deviance Table
## 
## Model 1: survived ~ sex
## Model 2: survived ~ sex + age
##   Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)
## 1      1044     1102.0                     
## 2      1043     1101.3  1   0.6694   0.4133
```

.purple[La diferencia entre los modelos no es estadísticamente significativa con una probabilidad. Por lo tanto el modelo con dos predictores (sexo + edad) no ofrece un mejor ajuste a los datos que un modelo con solo un predictor (sexo).
]
]
]

---
.pull-left[
## Test de razón de verosimilitud 
.medium[
Probemos ahora con otro modelo con la variable clase `pclass`:
- alta (ref)
- intermedia
- baja
]

.small[

```r
modelo_titanic3 &lt;- glm(survived ~ 
sex + pclass, 
data = tt, 
family = "binomial")
```
]
]
.pull-right[.small[

&lt;table class="texreg" style="margin: 10px auto;border-collapse: collapse;border-spacing: 0px;caption-side: bottom;color: #000000;border-top: 2px solid #000000;"&gt;
&lt;caption&gt; &lt;/caption&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/th&gt;
&lt;th style="padding-left: 5px;padding-right: 5px;"&gt;Logit&lt;/th&gt;
&lt;th style="padding-left: 5px;padding-right: 5px;"&gt;OR&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr style="border-top: 1px solid #000000;"&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Intercepto&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-0.37&lt;sup&gt;*&lt;/sup&gt;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;0.69&lt;sup&gt;*&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;(0.15)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Mujer (Ref=Hombre)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;2.53&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;12.53&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;(0.16)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Clase Intermedia&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-0.90&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;0.41&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;(0.21)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Clase Baja&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-1.72&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;0.18&lt;sup&gt;***&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;(0.19)&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr style="border-top: 1px solid #000000;"&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;AIC&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1021.80&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1021.80&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;BIC&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1041.61&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1041.61&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Log Likelihood&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-506.90&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;-506.90&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Deviance&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1013.80&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1013.80&lt;/td&gt;
&lt;/tr&gt;
&lt;tr style="border-bottom: 2px solid #000000;"&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;Num. obs.&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1046&lt;/td&gt;
&lt;td style="padding-left: 5px;padding-right: 5px;"&gt;1046&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;
&lt;tr&gt;
&lt;td style="font-size: 0.8em;" colspan="3"&gt;&lt;sup&gt;***&lt;/sup&gt;p &amp;lt; 0.001; &lt;sup&gt;**&lt;/sup&gt;p &amp;lt; 0.01; &lt;sup&gt;*&lt;/sup&gt;p &amp;lt; 0.05&lt;/td&gt;
&lt;/tr&gt;
&lt;/tfoot&gt;
&lt;/table&gt;

]
]

---
## Test de razón de verosimilitud 

.small[

```r
anova(modelo_titanic, modelo_titanic3, test ="Chisq")
```

```
## Analysis of Deviance Table
## 
## Model 1: survived ~ sex
## Model 2: survived ~ sex + pclass
##   Resid. Df Resid. Dev Df Deviance  Pr(&gt;Chi)    
## 1      1044     1102.0                          
## 2      1042     1013.8  2   88.211 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```
]
.medium[
.purple[La diferencia entre los modelos es estadísticamente significativa con una probabilidad p &lt; 0.001. Por lo tanto el modelo con dos predictores (sexo + pclass) ofrece un mejor ajuste a los datos que un modelo con solo un predictor (sexo).]
]

---
## Test de razón de verosimilitud 

.medium[
- También se puede realizar la comparación con el modelo nulo (sin predictores), que es equivalente al promedio en el caso de variables continuas
]
.small[
  

```r
modelo_titanic_null &lt;- glm(survived ~ 1, data = tt, family = "binomial")
anova(modelo_titanic_null, modelo_titanic3, test ="Chisq")
```

```
## Analysis of Deviance Table
## 
## Model 1: survived ~ 1
## Model 2: survived ~ sex + pclass
##   Resid. Df Resid. Dev Df Deviance  Pr(&gt;Chi)    
## 1      1045     1414.6                          
## 2      1042     1013.8  3   400.82 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```
]

---
##  McFadden (pseudo) R2

Se define como: `\(1−[LL(LM)/LL(L0)]\)`, donde
.small[
- LL es el log likelihood del modelo
- LM es el modelo posterior (con más predictores)
- L0 es el modelo nulo


```r
logLik(modelo_titanic); logLik(modelo_titanic_null)
```

```
## 'log Lik.' -551.0042 (df=2)
```

```
## 'log Lik.' -707.3102 (df=1)
```

```r
1-(-551/-707)
```

```
## [1] 0.2206506
```

]

---
#  McFadden (pseudo) R2

También se puede obtener con la función `PseudoR2` de la librería `DescTools`, junto a otras versiones de pseudo R2s, como "Nagelkerke", "CoxSnell" y "Effron".


---
## Akaike (AIC)
.medium[
**AIC - Akaike information criteria**, evalua la calidad del modelo a través de la comparación con otros modelos penalizando por la inclusión de predictores (análogo al R2 ajustado):

`$$AIC=-2(log-likelihood)+2K$$`

Donde K= número de parámetros del modelo (regresores + intercepto)



]

A menor AIC, mejor ajuste
---
## Akaike (AIC)


```r
logLik(modelo_titanic)
```

```
## 'log Lik.' -551.0042 (df=2)
```

```r
2*551
```

```
## [1] 1102
```
`$$AIC=-2(-551)+2(2)=1102+4=1106$$`


---
# Resumen Ajuste

- diferentes aproximaciones

- utilizar más de una forma

- en general: LRT (test de razón de verosimilitud) y algún tipo de R2


---
class: inverse, left

## RESUMEN

-  Limitaciones de regresión tradicional (OLS) para variables dependientes dicotómicas

- Logit permite implementar regresión (coeficientes e inferencia) con dependientes dicotómicas

- En regresión logística la interpretación sustantiva de coeficientes se realiza con los odds-ratio (exponenciando los coeficientes logit)

- Ajuste: medidas comparativas basadas en la log-verosimilitud de los modelos




???
Remember, though, just like in logistic regression, the difference in the probability isn’t equal for each 1-unit change in the predictor. The sigmoidal relationship between a predictor and probability is nearly identical in probit and logistic regression. A 1-unit difference in X will have a bigger impact on probability in the middle than near 0 or 1.

---
class: roja right middle

### Próxima semana

## Revisión de supuestos del modelo de regresión

---
class: front

.pull-left[
# Estadística Multivariada
## Juan Carlos Castillo
## Sociología FACSO - UChile
## 1er Sem 2021
## [multivariada.netlify.com](https://multivariada.netlify.com)
]


.pull-right[
.right[
&lt;br&gt;
![:scale 80%](https://multivariada.netlify.com/img/hex_multiva.png)
]

]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://multinivel.netlify.com/docpres/xaringan_custom/macros.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>
<style>
.logo {
  background-image: url("../hex_multiva_white.png");
  background-size: contain;
  background-repeat: no-repeat;
  position: absolute;
  top: 16.3em;
  right: 31em;
  width: 110px;
  height: 70px;
  z-index: 0;
}
</style>

<script>
document
  .querySelectorAll(
    '.remark-slide-content' +
    ':not(.title-slide)' +
    // add additional classes to exclude here, e.g.
    // ':not(.inverse)' +
    ':not(.hide-logo)'
  )
  .forEach(el => {
    el.innerHTML += '<div class="logo"></div>';
  });
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
